---
layout: post
title:  关于聊天室编写的一些记录
date:   2019-05-15 19:49:00 +0800
categories: note
tag: C/C++
---

* content
{:toc}


 >由于课程需求，我需要在linux环境下编写一个可以实现多人聊天功能聊天室。当时编写的程序确实可以完成基本的聊天功能，不得不说这个真的很神奇。课程结束后我仍在继续完善自己的聊天室，到目前为止，我的程序经历了不知道多少次修改，考虑到它还需要进一步完善，我决定写一篇博客记录一下我完成这个聊天室的过程。

### 2019年5月：从多进程转到多线程
 既然是一个多人聊天室，服务端需要同时处理以下事件：
 + 随时接收任一客户的消息并分发给所有客户
 + 随时处理新的客户的登录/注册
 
 显然，需要使用多线程或者多进程来处理这么多可能“同时”发生的事。
 我一开始使用的是多进程，因为创建进程函数fork的使用看起来要简单一些。然而当时的我没有意识到一个问题--进程之间的数据是不共享的, 即使是全局变量或者是指针。所以给后面的编程造成了很大的麻烦，我印象深刻的一点是服务端给客户端分发消息，后登录的客户可以发给先登录的，反之则不行。这是因为进程数据不共享，处理先登录的客户的进程“不知道”后面又有一个客户连接上了。后来请教老师，了解到了进程间通信的一些方法，但是我最终还是决定采取多线程的方式。
 
### 2019年6月：开始使用数据库和Qt
 作为一个聊天室程序，用户名和密码是绕不开的。使用文件操作应该也能管理，但为什么不一步到位使用数据库呢?这样我最后选择了比较轻量的sqlite3数据库,相关操作我在另一篇博客中已经写过了,详见: [这里](https://mp.csdn.net/mdeditor/92985658#)
 之后我想，作为一个聊天室，总不能一直在黑框框下运行吧，客户端需要一个图形界面还是比较靠谱。无论从哪方面看Qt都是我最好的选择，经过一段时间的努力，终于在Linux下和Windows都可以部署应用程序。不得不说Qt的Socket函数还是封装的不错的，直接调用即可；收发消息自带多线程，需求不高的话暂时不必多操心这个方面。可是当时的聊天室还是有很多bug，比如两个用户不能同时登录，否则会卡死，这是因为服务端处理登录也需要多线程；甚至会时不时崩溃，这个原因我至今不明白,我将这个版本称为1.0版本。还有就是我把用(Enigma Virtual Box)封装好的程序发给同学后他表示360报毒，我很难受...，更难受的是我忙了两天在电脑上部署安卓开发环境想把程序移植到安卓上都失败了，这感觉就像被人喂了一口shit...
 经过一系列的修改，作为单个多人聊天室，几乎可以完成基本的任务了。但是我现在想的是能不能实现一个“创建”聊天室的功能，建立不同的聊天室同时聊天。期末考试周有点忙，进度放缓了。
